# Reasons to divide us

library(haven)
library(descr)
library(tidyverse)
library(ggeffects)
library(survey)
library(MASS)

NDI19 <- read_dta("NDI_2019_April_22.04.19_Public.dta")

names(NDI19)

freq(as_factor(NDI19$UNDEPOL))
freq(NDI19$UNDEPOL)


NDI19$UNDEGEME_r<-NDI19$UNDEGEME
NDI19$UNDEGEME_r[NDI19$UNDEGEME_r<=-2]<-NA
NDI19$UNDEGEME_r<-(NDI19$UNDEGEME_r+2)
NDI19$UNDEGEME_r[NDI19$UNDEGEME_r!=2]<-0
NDI19$UNDEGEME_r[NDI19$UNDEGEME_r==2]<-1
table(NDI19$UNDEGEME_r)

NDI19$UNDEPOL_r<-NDI19$UNDEPOL
NDI19$UNDEPOL_r[NDI19$UNDEPOL_r<=-2]<-NA
NDI19$UNDEPOL_r<-(NDI19$UNDEPOL_r+2)
NDI19$UNDEPOL_r[NDI19$UNDEPOL_r!=2]<-0
NDI19$UNDEPOL_r[NDI19$UNDEPOL_r==2]<-1
table(NDI19$UNDEPOL_r)

NDI19$UNDEREL_r<-NDI19$UNDEREL
NDI19$UNDEREL_r[NDI19$UNDEREL_r<=-2]<-NA
NDI19$UNDEREL_r<-(NDI19$UNDEREL_r+2)
NDI19$UNDEREL_r[NDI19$UNDEREL_r!=2]<-0
NDI19$UNDEREL_r[NDI19$UNDEREL_r==2]<-1
table(NDI19$UNDEREL_r)

NDI19$UNDEEDIN_r<-NDI19$UNDEEDIN
NDI19$UNDEEDIN_r[NDI19$UNDEEDIN_r<=-2]<-NA
NDI19$UNDEEDIN_r<-(NDI19$UNDEEDIN_r+2)
NDI19$UNDEEDIN_r[NDI19$UNDEEDIN_r!=2]<-0
NDI19$UNDEEDIN_r[NDI19$UNDEEDIN_r==2]<-1
table(NDI19$UNDEEDIN_r)

NDI19$UNDECOLE_r<-NDI19$UNDECOLE
NDI19$UNDECOLE_r[NDI19$UNDECOLE_r<=-2]<-NA
NDI19$UNDECOLE_r<-(NDI19$UNDECOLE_r+2)
NDI19$UNDECOLE_r[NDI19$UNDECOLE_r!=2]<-0
NDI19$UNDECOLE_r[NDI19$UNDECOLE_r==2]<-1
table(NDI19$UNDECOLE_r)

NDI19$UNDEECSY_r<-NDI19$UNDEECSY
NDI19$UNDEECSY_r[NDI19$UNDEECSY_r<=-2]<-NA
NDI19$UNDEECSY_r<-(NDI19$UNDEECSY_r+2)
NDI19$UNDEECSY_r[NDI19$UNDEECSY_r!=2]<-0
NDI19$UNDEECSY_r[NDI19$UNDEECSY_r==2]<-1
table(NDI19$UNDEECSY_r)

NDI19$UNDELABO_r<-NDI19$UNDELABO
NDI19$UNDELABO_r[NDI19$UNDELABO_r<=-2]<-NA
NDI19$UNDELABO_r<-(NDI19$UNDELABO_r+2)
NDI19$UNDELABO_r[NDI19$UNDELABO_r!=2]<-0
NDI19$UNDELABO_r[NDI19$UNDELABO_r==2]<-1
table(NDI19$UNDELABO_r)

NDI19$UNDECISO_r<-NDI19$UNDECISO
NDI19$UNDECISO_r[NDI19$UNDECISO_r<=-2]<-NA
NDI19$UNDECISO_r<-(NDI19$UNDECISO_r+2)
NDI19$UNDECISO_r[NDI19$UNDECISO_r!=2]<-0
NDI19$UNDECISO_r[NDI19$UNDECISO_r==2]<-1
table(NDI19$UNDECISO_r)

NDI19$UNDEEU_r<-NDI19$UNDEEU
NDI19$UNDEEU_r[NDI19$UNDEEU_r<=-2]<-NA
NDI19$UNDEEU_r<-(NDI19$UNDEEU_r+2)
NDI19$UNDEEU_r[NDI19$UNDEEU_r!=2]<-0
NDI19$UNDEEU_r[NDI19$UNDEEU_r==2]<-1
table(NDI19$UNDEEU_r)

NDI19$UNDENATO_r<-NDI19$UNDENATO
NDI19$UNDENATO_r[NDI19$UNDENATO_r<=-2]<-NA
NDI19$UNDENATO_r<-(NDI19$UNDENATO_r+2)
NDI19$UNDENATO_r[NDI19$UNDENATO_r!=2]<-0
NDI19$UNDENATO_r[NDI19$UNDENATO_r==2]<-1
table(NDI19$UNDENATO_r)

NDI19$UNDERUS_r<-NDI19$UNDERUS
NDI19$UNDERUS_r[NDI19$UNDERUS_r<=-2]<-NA
NDI19$UNDERUS_r<-(NDI19$UNDERUS_r+2)
NDI19$UNDERUS_r[NDI19$UNDERUS_r!=2]<-0
NDI19$UNDERUS_r[NDI19$UNDERUS_r==2]<-1

table(NDI19$UNDERUS_r)

freq(NDI19$division, NDI19$WTIND)
svymean(NDI19svy$variables$division, design = NDI19svy, na.rm=TRUE)
table(NDI19$division)
NDI19$division<-(NDI19$UNDEPOL_r+
    NDI19$UNDEGEME_r+
    NDI19$UNDEREL_r+
    NDI19$UNDEEDIN_r+
    NDI19$UNDECOLE_r+
    NDI19$UNDEECSY_r+
    NDI19$UNDELABO_r+
    NDI19$UNDECISO_r+
    NDI19$UNDEEU_r+
    NDI19$UNDENATO_r+
    NDI19$UNDERUS_r)
options(scipen = 99)
NDI19[NDI19==-3]<-NA

freq(NDI19$UNDEPOL, NDI19$WTIND)
freq(NDI19$UNDEGEME, NDI19$WTIND)
freq(NDI19$UNDEREL, NDI19$WTIND)
freq(NDI19$UNDEEDIN, NDI19$WTIND)
freq(NDI19$UNDECOLE, NDI19$WTIND)
freq(NDI19$UNDEECSY, NDI19$WTIND)
freq(NDI19$UNDELABO, NDI19$WTIND)
freq(NDI19$UNDECISO, NDI19$WTIND)
freq(NDI19$UNDEEU, NDI19$WTIND)
freq(NDI19$UNDENATO, NDI19$WTIND)
freq(NDI19$UNDERUS, NDI19$WTIND)
table(as_factor(NDI19$SETTYPE))
table(as_factor(NDI19$RESPEDU))
table(NDI19$RESPEDU)
NDI19$RESPEDU_r<-NDI19$RESPEDU
NDI19$RESPEDU_r[NDI19$RESPEDU_r<=-1]<-NA
NDI19$RESPEDU_r[NDI19$RESPEDU_r<=3]<-1
NDI19$RESPEDU_r[NDI19$RESPEDU_r==4]<-2
NDI19$RESPEDU_r[NDI19$RESPEDU_r>=5]<-3
NDI19$RESPEDU_r<-as.factor(NDI19$RESPEDU_r)

NDI19$OWNFRDG_r<-NDI19$OWNFRDG
NDI19$OWNFRDG_r[NDI19$OWNFRDG_r<=-1]<-NA

NDI19$OWNCOTV_r<-NDI19$OWNCOTV
NDI19$OWNCOTV_r[NDI19$OWNCOTV_r<=-1]<-NA

NDI19$OWNSPHN_r<-NDI19$OWNSPHN
NDI19$OWNSPHN_r[NDI19$OWNSPHN_r<=-1]<-NA

NDI19$OWNTBLT_r<-NDI19$OWNTBLT
NDI19$OWNTBLT_r[NDI19$OWNTBLT_r<=-1]<-NA

NDI19$OWNCARS_r<-NDI19$OWNCARS
NDI19$OWNCARS_r[NDI19$OWNCARS_r<=-1]<-NA

NDI19$OWNAIRC_r<-NDI19$OWNAIRC
NDI19$OWNAIRC_r[NDI19$OWNAIRC_r<=-1]<-NA

NDI19$OWNWASH_r<-NDI19$OWNWASH
NDI19$OWNWASH_r[NDI19$OWNWASH_r<=-1]<-NA

NDI19$OWNCOMP_r<-NDI19$OWNCOMP
NDI19$OWNCOMP_r[NDI19$OWNCOMP_r<=-1]<-NA

NDI19$OWNHWT_r<-NDI19$OWNHWT
NDI19$OWNHWT_r[NDI19$OWNHWT_r<=-1]<-NA

NDI19$OWNCHTG_r<-NDI19$OWNCHTG
NDI19$OWNCHTG_r[NDI19$OWNCHTG_r<=-1]<-NA

NDI19$assets<-(NDI19$OWNFRDG_r+
    NDI19$OWNCOTV_r+
    NDI19$OWNSPHN_r+
    NDI19$OWNTBLT_r+
    NDI19$OWNCARS_r+
    NDI19$OWNAIRC_r+
    NDI19$OWNWASH_r+
    NDI19$OWNCOMP_r+
    NDI19$OWNHWT_r+
    NDI19$OWNCHTG_r)

table(as_factor(NDI19$ETHNIC))
NDI19$ETHNIC_r<-NDI19$ETHNIC
NDI19$ETHNIC_r[NDI19$ETHNIC_r<=-1]<-NA
NDI19$ETHNIC_r[NDI19$ETHNIC_r>=4]<-NA
NDI19$ETHNIC_r[NDI19$ETHNIC_r==3]<-0
NDI19$ETHNIC_r<-as.factor(NDI19$ETHNIC_r)

table(as_factor(NDI19$SUBSTRATUM))
table(NDI19$SUBSTRATUM)

NDI19$SUBSTRATUM_r<-NDI19$SUBSTRATUM
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==10]<-1
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==21]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==22]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==23]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==24]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==25]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==26]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==31]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==32]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==33]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==34]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==51]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==61]<-2
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==41]<-3
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==42]<-3
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==43]<-3
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==44]<-3
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==52]<-3
NDI19$SUBSTRATUM_r[NDI19$SUBSTRATUM_r==62]<-3
table(NDI19$SUBSTRATUM_r)
NDI19$SUBSTRATUM_r<-as.factor(NDI19$SUBSTRATUM_r)

hist(NDI19$assets)
str(NDI19$SUBSTRATUM_r)
NDI19$RESPSEX<-as.factor(NDI19$RESPSEX)
NDI19$HAVEJOB<-as.factor(NDI19$HAVEJOB)
NDI19$division<-as.numeric(NDI19$division)
NDI19$RESPAGE<-as.numeric(NDI19$RESPAGE)
NDI19svy <- svydesign(id=~PSU, strata=~SUBSTRATUM, 
                         weights=~WTIND,  
                         data=NDI19)
table(as.factor(NDI19svy$variables$HAVEJOB))
NDI19svy$variables$HAVEJOB[NDI19svy$variables$HAVEJOB=="-1"]<-NA
NDI19svy$variables$HAVEJOB[NDI19svy$variables$HAVEJOB=="-2"]<-NA
NDI19svy$variables$HAVEJOB[NDI19svy$variables$HAVEJOB=="-3"]<-NA

freq(as_factor(NDI19$ETHNIC))

model1<-svyglm(division~RESPAGE+
              RESPSEX+
              RESPEDU_r+
              assets+
              ETHNIC_r+
              SUBSTRATUM_r+
              HAVEJOB, design = NDI19svy)
summary(model1)


plot(ggpredict(model1))
NDI19$UNDEPOL_r_r<-NDI19$UNDEPOL
NDI19$UNDEPOL_r_r[NDI19$UNDEPOL_r_r<=-1]<-NA

NDI19$UNDEGEME_r_r<-NDI19$UNDEGEME
NDI19$UNDEGEME_r_r[NDI19$UNDEGEME_r_r<=-1]<-NA

NDI19$UNDEREL_r_r<-NDI19$UNDEREL
NDI19$UNDEREL_r_r[NDI19$UNDEREL_r_r<=-1]<-NA

NDI19$UNDEEDIN_r_r<-NDI19$UNDEEDIN
NDI19$UNDEEDIN_r_r[NDI19$UNDEEDIN_r_r<=-1]<-NA

NDI19$UNDECOLE_r_r<-NDI19$UNDECOLE
NDI19$UNDECOLE_r_r[NDI19$UNDECOLE_r_r<=-1]<-NA

NDI19$UNDEECSY_r_r<-NDI19$UNDEECSY
NDI19$UNDEECSY_r_r[NDI19$UNDEECSY_r_r<=-1]<-NA

NDI19$UNDELABO_r_r<-NDI19$UNDELABO
NDI19$UNDELABO_r_r[NDI19$UNDELABO_r_r<=-1]<-NA

NDI19$UNDECISO_r_r<-NDI19$UNDECISO
NDI19$UNDECISO_r_r[NDI19$UNDECISO_r_r<=-1]<-NA

NDI19$UNDEEU_r_r<-NDI19$UNDEEU
NDI19$UNDEEU_r_r[NDI19$UNDEEU_r_r<=-1]<-NA

NDI19$UNDENATO_r_r<-NDI19$UNDENATO
NDI19$UNDENATO_r_r[NDI19$UNDENATO_r_r<=-1]<-NA

NDI19$UNDERUS_r_r<-NDI19$UNDERUS
NDI19$UNDERUS_r_r[NDI19$UNDERUS_r_r<=-1]<-NA

crosstab(NDI19$UNDEPOL_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDEGEME_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDEREL_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDEEDIN_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDECOLE_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDEECSY_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDELABO_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDECISO_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDEEU_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDENATO_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
crosstab(NDI19$UNDERUS_r_r, NDI19$ETHNIC_r, w=NDI19$WTIND, prop.c=TRUE)
table(as_factor(NDI19$UNDERUS_r_r))
table(NDI19$division_noDK)

NDI19$division_noDK<-(NDI19$UNDEPOL_r_r+
                        NDI19$UNDEGEME_r_r+
  NDI19$UNDEREL_r_r+
  NDI19$UNDEEDIN_r_r+
  NDI19$UNDECOLE_r_r+
  NDI19$UNDEECSY_r_r+
  NDI19$UNDELABO_r_r+
  NDI19$UNDECISO_r_r+
  NDI19$UNDEEU_r_r+
  NDI19$UNDENATO_r_r+
  NDI19$UNDERUS_r_r)

NDI19svy <- svydesign(id=~PSU, strata=~SUBSTRATUM, 
                      weights=~WTIND,  
                      data=NDI19)
table(as.factor(NDI19svy$variables$HAVEJOB))
NDI19svy$variables$HAVEJOB[NDI19svy$variables$HAVEJOB=="-1"]<-NA
NDI19svy$variables$HAVEJOB[NDI19svy$variables$HAVEJOB=="-2"]<-NA
NDI19svy$variables$HAVEJOB[NDI19svy$variables$HAVEJOB=="-3"]<-NA

model1<-svyglm(division~RESPAGE+
                 RESPSEX+
                 RESPEDU_r+
                 assets+
                 ETHNIC_r+
                 SUBSTRATUM_r+
                 HAVEJOB, design = NDI19svy)
summary(model1)
